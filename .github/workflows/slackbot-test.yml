name: Slackbot Test

on:
  workflow_dispatch:

jobs:
  test-connection:
    runs-on: ubuntu-latest
    steps:
      - name: Send Slack test message
        env:
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
          SLACK_CHANNEL: C0A7QE8K7R8
        run: |
          set -eo pipefail
          # Sample payload mirrors citation-check format to validate Slack schema
          payload=$(python -c $'import json, os\ntitle="Citation check finished for citation-check-test"\nsummary="Sample summary for Slack schema validation."\nsummary_block=f"```\\n{summary}\\n```"\npayload={"channel":os.environ["SLACK_CHANNEL"],"text":title,"blocks":[{"type":"section","text":{"type":"mrkdwn","text":f"*{title}*"}},{"type":"section","text":{"type":"mrkdwn","text":"Summary below."}},{"type":"section","text":{"type":"mrkdwn","text":summary_block}}]}\nprint(json.dumps(payload))')
          curl -X POST https://slack.com/api/chat.postMessage \
            -H "Authorization: Bearer $SLACK_BOT_TOKEN" \
            -H "Content-Type: application/json" \
            --data "$payload"
